#include <iom16v.h>		
#include <macros.h>
//-----------------------------------------------
#define uchar unsigned char	
#define uint unsigned int
//---------------引脚电平的宏定义
#define RS_1 PORTB|=BIT(PB0)	 
#define RS_0 PORTB&=~BIT(PB0) 
#define RW_1 PORTB|=BIT(PB1)	 
#define RW_0 PORTB&=~BIT(PB1)
#define EN_1 PORTB|=BIT(PB2)	 
#define EN_0 PORTB&=~BIT(PB2) 
#define CS1_1 PORTB|=BIT(PB3)	  
#define CS1_0 PORTB&=~BIT(PB3) 
#define CS2_1 PORTB|=BIT(PB4)	 
#define CS2_0 PORTB&=~BIT(PB4)
#define RST_1 PORTB|=BIT(PB5)	 
#define RST_0 PORTB&=~BIT(PB5) 
//======================================
#define DataPort PORTA		//端口定义，双向数据总线。
#define xtal 8   				

void Delay_1ms(void)		//1mS延时子函数
{ uint i;
 for(i=1;i<(uint)(xtal*143-2);i++)
;
}
//====================================
void Delay_nms(uint n)		//n*1mS延时子函数
{
 uint i=0;
   while(i<n)
   {Delay_1ms();
    i++;
   }
}
/**********函数声明列表*************/
void Delay_1ms(void);
void Delay_nms(uint n);		
void wcode(uchar c,uchar sel_l,uchar sel_r);
void wdata(uchar c,uchar sel_l,uchar sel_r);
void set_startline(uchar i);			
void set_xy(uchar x,uchar y);			
void dison_off(uchar o);				
void reset(void);						
void m16_init(void);
void lcd_init(void);					
void lw(uchar x, uchar y, uchar dd);
void display_hz(uchar x, uchar y, uchar n, uchar fb);
const uchar hz[];						
/*************主函数*************/

void main(void)	
{								
uchar loop;						
m16_init();			
lcd_init();			
Delay_nms(1000);		
while(1)				
{				
/************************************/
for(loop=0;loop<8;loop++)			
	{display_hz(2*loop,0,loop,0);	
	display_hz(2*loop,0,loop,0);	
	display_hz(2*loop,0,loop,0);	
	display_hz(2*loop,0,loop,0);	
	display_hz(2*loop,0,loop,0);	
	display_hz(2*loop,0,loop,0);	
	display_hz(2*loop,0,loop,0);	
	display_hz(2*loop,0,loop,0);}	
/******************************************/
for(loop=0;loop<8;loop++)			
	{display_hz(2*loop,2,loop+8,0);	
	display_hz(2*loop,2,loop+8,0);	
	display_hz(2*loop,2,loop+8,0);	
	display_hz(2*loop,2,loop+8,0);	
	display_hz(2*loop,2,loop+8,0);	
	display_hz(2*loop,2,loop+8,0);	
	display_hz(2*loop,2,loop+8,0);	
	display_hz(2*loop,2,loop+8,0);}	
/*************************************/
for(loop=0;loop<8;loop++)		
	{display_hz(2*loop,4,loop+16,1);
	display_hz(2*loop,4,loop+16,1);	
	display_hz(2*loop,4,loop+16,1);
	display_hz(2*loop,4,loop+16,1);
	display_hz(2*loop,4,loop+16,1);
	display_hz(2*loop,4,loop+16,1);
	display_hz(2*loop,4,loop+16,1);
	display_hz(2*loop,4,loop+16,1);}//60

/**********************************/
for(loop=0;loop<8;loop++)
	{display_hz(2*loop,6,loop+24,1);
	display_hz(2*loop,6,loop+24,1);
	display_hz(2*loop,6,loop+24,1);
	display_hz(2*loop,6,loop+24,1);
	display_hz(2*loop,6,loop+24,1);
	display_hz(2*loop,6,loop+24,1);
	display_hz(2*loop,6,loop+24,1);
	display_hz(2*loop,6,loop+24,1);}
/*******************************/
Delay_nms(3000);				
}								
}								
/*----------------ATMEGA16L初始化子函数。-----------------------*/
void m16_init(void)
{
PORTA=0x00;
DDRA=0xff;
PORTB=0x00;
DDRB=0xff;
}
/*---------------判LCM忙子函数---------------*/
void lcd_busy(void)      		
{
uchar val;                     	
RS_0;_NOP();
RW_1;_NOP();
DataPort=0x00;					
 	while(1)
	{							
	EN_1;_NOP();
	DDRA=0x00;
	val=PINA;			 		
	if(val<0x80) break;      	
	EN_0;_NOP();				
	}
DDRA=0xff;             			
EN_0;_NOP();           			
}                    			
/*--------------写指令到LCM子函数---------------*/
void wcode(uchar c,uchar sel_l,uchar sel_r) 
{	
if(sel_l==1)CS1_1;
else CS1_0;						
_NOP();                 		
if(sel_r==1)CS2_1;
else CS2_0;
_NOP();							
lcd_busy();						
RS_0;_NOP();					
RW_0;_NOP();					
DataPort=c;						
EN_1;_NOP();					
EN_0;_NOP();					
}								
/*---------------写数据到LCM子函数-------------*/
void wdata(uchar c,uchar sel_l,uchar sel_r) 
{								
if(sel_l==1)CS1_1;
else CS1_0;		
_NOP();             
if(sel_r==1)CS2_1;
else CS2_0;                 
_NOP();					
lcd_busy();						
RS_1;_NOP();					
RW_0;_NOP();					
DataPort=c;                   
EN_1;_NOP();			
EN_0;_NOP();			
}						
/*根据x、y地址定位，将数据写入LCM左半屏或右半屏的子函数*/
void lw(uchar x, uchar y, uchar dd)	
{								
if(x>=64) 						
{set_xy(x-64,y);				
wdata(dd,0,1);}		
else 						
{set_xy(x,y);				
wdata(dd,1,0);}			
}						
/*---------------设定起始行子函数--------------*/
void set_startline(uchar i) 	
{								
i=0xc0+i;					
wcode(i,1,1);				
}						
/*---------------定位x方向、y方向的子函数--------------*/
void set_xy(uchar x,uchar y) 	
{								
x=x+0x40;                      	
y=y+0xb8;                    	
wcode(x,1,1);                  
wcode(y,1,1);                  
}                             	
/*---------------屏幕开启、关闭子函数--------------*/
void dison_off(uchar o) 		
{                              	
o=o+0x3e;                    	
wcode(o,1,1);                
}                              
/*---------------复位子函数---------------*/
void reset(void)                
{                       		
RST_0;                     	
Delay_nms(10);				
RST_1;							
Delay_nms(10);				
}								
/*--------------LCM初始化子函数-------------*/
void lcd_init(void) 			
{uchar x,y;              		
reset();						
set_startline(0);				
dison_off(0);					
for(y=0;y<8;y++)				
	{							
	for(x=0;x<128;x++)lw(x,y,0);
	}							
dison_off(1);				
}						
/*---------------显示汉字子函数--------------*/
void display_hz(uchar xx, uchar yy, uchar n, uchar fb) 
{					
uchar i,dx;                     
for(i=0;i<16;i++)				
{dx=hz[2*i+n*32];				
if(fb)dx=255-dx;				
lw(xx*8+i,yy,dx);				
dx=hz[(2*i+1)+n*32];			
if(fb)dx=255-dx;			
lw(xx*8+i,yy+1,dx);			
}								
}								
/************************汉字点阵码表*********************/
const uchar hz[]=					
{0x00,0x04,0x00,0x04,0x00,0x04,0xFE,0x04,0x92,0x04,0x92,0x04,0x92,0x04,0x92,0xFF,
0x92,0x04,0x92,0x04,0x92,0x04,0x92,0x04,0xFE,0x04,0x00,0x04,0x00,0x04,0x00,0x00,/*"早",0*/

0x24,0x00,0x24,0x7E,0x24,0x22,0xFC,0x23,0x22,0x22,0x22,0x7E,0xA0,0x00,0x84,0x04,
0x94,0x04,0xA5,0x04,0x86,0xFF,0x84,0x04,0xA4,0x04,0x94,0x04,0x84,0x04,0x00,0x00,/*"辞",1*/

0x00,0x00,0x00,0x00,0xF8,0x7F,0x08,0x21,0x08,0x21,0x0C,0x21,0x0B,0x21,0x08,0x21,
0x08,0x21,0x08,0x21,0x08,0x21,0x08,0x21,0xF8,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,/*"白",2*/

0x80,0x00,0x64,0x00,0x24,0x00,0x24,0x3F,0x2C,0x01,0x34,0x01,0x25,0x01,0xE6,0xFF,
0x24,0x01,0x24,0x11,0x34,0x21,0x2C,0x1F,0xA4,0x00,0x64,0x00,0x24,0x00,0x00,0x00,/*"帝",3*/

0x82,0x20,0x8A,0x10,0xB2,0x08,0x86,0x06,0xDB,0xFF,0xA1,0x02,0x91,0x04,0x8D,0x58,
0x88,0x48,0x20,0x20,0x10,0x22,0x08,0x11,0x86,0x08,0x64,0x07,0x40,0x02,0x00,0x00,/*"彩",4*/

0x40,0x00,0x40,0x20,0x44,0x70,0x44,0x38,0x44,0x2C,0x44,0x27,0xC4,0x23,0xC4,0x31,
0x44,0x10,0x44,0x12,0x46,0x14,0x46,0x18,0x64,0x70,0x60,0x20,0x40,0x00,0x00,0x00,/*"云",5*/

0x00,0x00,0xF8,0xFF,0x01,0x00,0x06,0x00,0x00,0x00,0xF0,0x07,0x92,0x04,0x92,0x04,
0x92,0x04,0x92,0x04,0xF2,0x07,0x02,0x40,0x02,0x80,0xFE,0x7F,0x00,0x00,0x00,0x00,/*"间",6*/

0x00,0x00,0x00,0x00,0x00,0x58,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"，",7*/

0x40,0x00,0x40,0x00,0x44,0x00,0x44,0x00,0x44,0x00,0x44,0x00,0x44,0x00,0xFC,0x7F,
0x42,0x00,0x42,0x00,0x42,0x00,0x43,0x00,0x42,0x00,0x60,0x00,0x40,0x00,0x00,0x00,/*"千",8*/

0x00,0x40,0x00,0x40,0xFF,0x44,0x91,0x44,0x91,0x44,0x91,0x44,0x91,0x44,0xFF,0x7F,
0x91,0x44,0x91,0x44,0x91,0x44,0x91,0x44,0xFF,0x44,0x00,0x40,0x00,0x40,0x00,0x00,/*"里",9*/

0x10,0x04,0x60,0x04,0x01,0x7E,0xC6,0x01,0x30,0x20,0x00,0x20,0x04,0x20,0x04,0x20,
0x04,0x20,0xFC,0x3F,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x00,0x20,0x00,0x00,/*"江",10*/

0x00,0x00,0xFE,0xFF,0x22,0x02,0x5A,0x04,0x86,0x43,0x10,0x48,0x94,0x24,0x74,0x22,
0x94,0x15,0x1F,0x09,0x34,0x15,0x54,0x23,0x94,0x60,0x94,0xC0,0x10,0x40,0x00,0x00,/*"陵",11*/

0x00,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,
0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0xC0,0x00,0x80,0x00,0x00,0x00,/*"一",12*/

0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x3F,0x42,0x10,0x42,0x10,0x42,0x10,0x42,0x10,
0x42,0x10,0x42,0x10,0x42,0x10,0xFE,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"日",13*/

0x40,0x40,0x41,0x20,0xCE,0x1F,0x04,0x20,0x00,0x42,0x02,0x41,0x82,0x40,0x42,0x40,
0xF2,0x5F,0x0E,0x40,0x42,0x40,0x82,0x40,0x02,0x47,0x02,0x42,0x00,0x40,0x00,0x00,/*"还",14*/

0x00,0x00,0x00,0x00,0x00,0x58,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"，",15*/

0x02,0x00,0xF2,0x7F,0x12,0x08,0x12,0x04,0x12,0x03,0xFE,0x00,0x92,0x10,0x12,0x09,
0x12,0x06,0xFE,0x01,0x12,0x01,0x12,0x26,0x12,0x40,0xFB,0x3F,0x12,0x00,0x00,0x00,/*"两",16*/

0x00,0x40,0x00,0x20,0xE0,0x1F,0x2E,0x04,0xA8,0x04,0xA8,0x04,0xA8,0x04,0xA8,0x04,
0xAF,0xFF,0xA8,0x04,0xA8,0x04,0xA8,0x04,0xA8,0x04,0xAE,0x04,0x20,0x04,0x00,0x00,/*"岸",17*/

0x20,0x04,0x12,0x42,0x0C,0x81,0x9C,0x40,0xE3,0x3F,0x10,0x10,0x14,0x08,0xD4,0xFD,
0x54,0x43,0x5F,0x27,0x54,0x09,0x54,0x11,0xD4,0x69,0x14,0xC4,0x10,0x44,0x00,0x00,/*"猿",18*/

0x02,0x40,0x12,0x30,0xD2,0x0F,0x52,0x02,0x52,0x02,0x52,0x02,0x52,0x02,0xDF,0x03,
0x52,0x02,0x52,0x02,0x52,0x02,0x52,0x02,0xD2,0x07,0x12,0x00,0x02,0x00,0x00,0x00,/*"声",19*/

0xFC,0x0F,0x04,0x02,0x04,0x02,0xFC,0x07,0x80,0x00,0x64,0x00,0x24,0x3F,0x2C,0x01,
0x35,0x01,0xE6,0xFF,0x24,0x11,0x34,0x21,0xAC,0x1F,0x66,0x00,0x24,0x00,0x00,0x00,/*"啼",20*/

0x00,0x00,0x02,0x08,0x02,0x04,0x02,0x02,0x02,0x01,0x82,0x00,0x42,0x00,0xFE,0x7F,
0x06,0x00,0x42,0x00,0xC2,0x00,0x82,0x01,0x02,0x07,0x03,0x02,0x02,0x00,0x00,0x00,/*"不",21*/

0x40,0x00,0x20,0x00,0xF0,0x7F,0x0C,0x00,0x03,0x20,0x08,0x21,0x08,0x21,0x09,0x21,
0x0A,0x21,0xFC,0x3F,0x08,0x21,0x08,0x21,0x8C,0x21,0x08,0x31,0x00,0x20,0x00,0x00,/*"住",22*/

0x00,0x00,0x00,0x00,0x00,0x58,0x00,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"，",23*/

0xC4,0x08,0xB4,0x08,0x8F,0x08,0xF4,0xFF,0x84,0x04,0x84,0x44,0x04,0x41,0x82,0x41,
0x42,0x41,0x22,0x41,0x12,0x7F,0x2A,0x41,0x46,0x41,0xC2,0x41,0x00,0x41,0x00,0x00,/*"轻",24*/

0x80,0x00,0x80,0x80,0x80,0x40,0x80,0x30,0xFC,0x0F,0x84,0x00,0x86,0x02,0x95,0x04,
0xA4,0x0C,0x84,0x40,0x84,0x80,0xFC,0x7F,0x80,0x00,0x80,0x00,0x80,0x00,0x00,0x00,/*"舟",25*/

0x00,0x00,0x00,0x00,0xE2,0x3F,0x42,0x20,0x42,0x20,0x42,0x20,0x42,0x20,0x42,0x20,
0x42,0x20,0x42,0x20,0x42,0x20,0x7E,0x20,0x00,0x20,0x00,0x3C,0x00,0x10,0x00,0x00,/*"已",26*/

0x80,0x40,0x81,0x20,0x8E,0x1F,0x04,0x20,0x00,0x20,0x10,0x40,0x50,0x40,0x90,0x43,
0x10,0x41,0x10,0x48,0x10,0x50,0xFF,0x4F,0x10,0x40,0x10,0x40,0x10,0x40,0x00,0x00,/*"过",27*/

0x00,0x00,0x02,0x40,0x02,0x20,0x02,0x10,0x02,0x0C,0x82,0x03,0x7E,0x00,0x22,0x00,
0x22,0x20,0x22,0x60,0x22,0x20,0xF2,0x1F,0x22,0x00,0x02,0x00,0x02,0x00,0x00,0x00,/*"万",28*/

0x08,0x40,0x08,0x40,0x0A,0x48,0xEA,0x4B,0xAA,0x4A,0xAA,0x4A,0xAA,0x4A,0xFF,0x7F,
0xA9,0x4A,0xA9,0x4A,0xA9,0x4A,0xE9,0x4B,0x08,0x48,0x08,0x40,0x08,0x40,0x00,0x00,/*"重",29*/

0x00,0x00,0x00,0x20,0xE0,0x7F,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0xFF,0x3F,
0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0xE0,0x7F,0x00,0x00,0x00,0x00,/*"山",30*/

0x00,0x00,0x00,0x18,0x00,0x24,0x00,0x24,0x00,0x18,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};/*"。",31*/
